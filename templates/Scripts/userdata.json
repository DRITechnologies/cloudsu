{
    "Fn::Base64": {
        "Fn::Join": [
            "", [
                "#!/bin/bash\n",
                "mkdir -p /etc/chef/ohai/hints\n",
                "echo \"{}\" > /etc/chef/ohai/hints/ec2.json\n",
                "retry()\n",
                "{\n",
                "for i in {1..3}\n",
                "do\n",
                "eval $*\n",
                "if [ $? = 0 ] ; then\n",
                "echo status $?\n",
                "return\n",
                "fi\n",
                "sleep 20\n",
                "done\n",
                "error_exit\n",
                "}\n",
                "function error_exit\n",
                "{\n",
                " /opt/aws/bin/cfn-signal -e 1 '", {
                    "Ref": "<%= wh_name %>"
                },
                "'\n",
                " exit 1\n",
                "}\n",
                "init_task()",
                "{\n",
                "/opt/aws/bin/cfn-init --region '", {
                    "Ref": "AWS::Region"
                },
                "'",
                " -s '", {
                    "Ref": "AWS::StackId"
                },
                "' -r '",
                "<%= wc_ref %>",
                "'\n",
                "}\n",
                "retry init_task\n",
                "/opt/aws/bin/cfn-signal -e 0 -r success '", {
                    "Ref": "<%= wh_name %>"
                },
                "'\n"
            ]
        ]
    }
}